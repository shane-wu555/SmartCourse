# 教师端知识点管理 API 文档

## 文档说明
- **基础URL**：`https://api.aicourse.com/v1`
- **认证方式**：Bearer Token (JWT)
- **权限要求**：教师角色
- **数据格式**：JSON
- **时间格式**：ISO 8601 (`yyyy-MM-dd'T'HH:mm:ss`)

---

## 1. 创建知识点
**在指定课程下创建新知识点**

### 请求信息
| 项目             | 内容                                               |
| ---------------- | -------------------------------------------------- |
| **HTTP方法**     | POST                                               |
| **端点**         | `/api/teacher/courses/{courseId}/knowledge-points` |
| **认证**         | Bearer Token                                       |
| **Content-Type** | `application/json`                                 |

### 路径参数
| 参数     | 类型   | 必需 | 说明   |
| -------- | ------ | ---- | ------ |
| courseId | String | 是   | 课程ID |

### 请求体
```json
{
  "name": "数据结构基础",
  "parentId": "kp001",
  "description": "基础数据结构概念",
  "difficulty": "MEDIUM"
}
```

字段说明：
- `name`: 知识点名称（必需，2-100字符）
- `parentId`: 父知识点ID（可选）
- `description`: 知识点描述（可选，最大1000字符）
- `difficulty`: 难度级别（可选，EASY/MEDIUM/HARD）

### 响应
**成功响应 (201 Created)**
```json
{
  "code": 201,
  "message": "知识点创建成功",
  "data": {
    "pointId": "kp002",
    "courseId": "c001",
    "name": "数据结构基础",
    "description": "基础数据结构概念",
    "parentId": "kp001",
    "difficulty": "MEDIUM",
    "createdAt": "2025-06-21T10:30:45",
    "updatedAt": "2025-06-21T10:30:45",
    "resourceCount": 0
  }
}
```

**错误响应**
- 400 Bad Request: 参数验证失败
- 403 Forbidden: 无权操作此课程
- 404 Not Found: 课程或父知识点不存在
- 409 Conflict: 知识点名称已存在
- 500 Internal Server Error: 服务器内部错误

---

## 2. 获取知识点列表
**获取课程下的知识点树形结构**

### 请求信息
| 项目         | 内容                                               |
| ------------ | -------------------------------------------------- |
| **HTTP方法** | GET                                                |
| **端点**     | `/api/teacher/courses/{courseId}/knowledge-points` |
| **认证**     | Bearer Token                                       |

### 路径参数
| 参数     | 类型   | 必需 | 说明   |
| -------- | ------ | ---- | ------ |
| courseId | String | 是   | 课程ID |

### 查询参数
| 参数        | 类型    | 必需 | 说明                         |
| ----------- | ------- | ---- | ---------------------------- |
| includeTree | Boolean | 否   | 是否返回树形结构（默认true） |
| keyword     | String  | 否   | 搜索关键词                   |
| difficulty  | String  | 否   | 难度过滤                     |

### 响应
**成功响应 (200 OK)**
```json
{
  "code": 200,
  "message": "成功获取知识点列表",
  "data": [
    {
      "pointId": "kp001",
      "name": "数据结构",
      "description": "数据结构核心概念",
      "difficulty": "MEDIUM",
      "createdAt": "2025-06-10T14:30:00",
      "updatedAt": "2025-06-15T09:15:00",
      "resourceCount": 5,
      "children": [
        {
          "pointId": "kp002",
          "name": "线性结构",
          "description": "数组、链表等线性数据结构",
          "difficulty": "EASY",
          "createdAt": "2025-06-12T11:20:00",
          "updatedAt": "2025-06-12T11:20:00",
          "resourceCount": 3,
          "children": [
            {
              "pointId": "kp003",
              "name": "链表",
              "description": "单向链表、双向链表等",
              "difficulty": "MEDIUM",
              "createdAt": "2025-06-14T16:45:00",
              "updatedAt": "2025-06-14T16:45:00",
              "resourceCount": 2
            }
          ]
        }
      ]
    },
    {
      "pointId": "kp004",
      "name": "算法分析",
      "description": "算法复杂度分析",
      "difficulty": "HARD",
      "createdAt": "2025-06-11T09:00:00",
      "updatedAt": "2025-06-18T14:20:00",
      "resourceCount": 4
    }
  ]
}
```

**错误响应**
- 403 Forbidden: 无权访问此课程
- 404 Not Found: 课程不存在

---

## 3. 获取知识点详情
**获取指定知识点的详细信息**

### 请求信息
| 项目         | 内容                                      |
| ------------ | ----------------------------------------- |
| **HTTP方法** | GET                                       |
| **端点**     | `/api/teacher/knowledge-points/{pointId}` |
| **认证**     | Bearer Token                              |

### 路径参数
| 参数    | 类型   | 必需 | 说明     |
| ------- | ------ | ---- | -------- |
| pointId | String | 是   | 知识点ID |

### 响应
**成功响应 (200 OK)**
```json
{
  "code": 200,
  "message": "成功获取知识点详情",
  "data": {
    "pointId": "kp002",
    "courseId": "c001",
    "courseName": "数据结构与算法",
    "name": "线性结构",
    "description": "数组、链表等线性数据结构",
    "parentId": "kp001",
    "parentName": "数据结构",
    "difficulty": "EASY",
    "createdAt": "2025-06-12T11:20:00",
    "updatedAt": "2025-06-12T11:20:00",
    "resourceCount": 3,
    "relatedPoints": [
      {
        "pointId": "kp005",
        "name": "栈与队列",
        "relationType": "PREREQUISITE"
      }
    ],
    "resources": [
      {
        "resourceId": "res001",
        "name": "线性结构讲义",
        "type": "PDF",
        "uploadTime": "2025-06-15T10:30:00"
      }
    ]
  }
}
```

**错误响应**
- 403 Forbidden: 无权访问此知识点
- 404 Not Found: 知识点不存在

---

## 4. 更新知识点
**更新知识点的元数据信息**

### 请求信息
| 项目             | 内容                                      |
| ---------------- | ----------------------------------------- |
| **HTTP方法**     | PUT                                       |
| **端点**         | `/api/teacher/knowledge-points/{pointId}` |
| **认证**         | Bearer Token                              |
| **Content-Type** | `application/json`                        |

### 路径参数
| 参数    | 类型   | 必需 | 说明     |
| ------- | ------ | ---- | -------- |
| pointId | String | 是   | 知识点ID |

### 请求体
```json
{
  "name": "更新后的知识点名称",
  "description": "更新后的知识点描述",
  "difficulty": "HARD"
}
```

### 响应
**成功响应 (200 OK)**
```json
{
  "code": 200,
  "message": "知识点更新成功",
  "data": {
    "pointId": "kp002",
    "name": "更新后的知识点名称",
    "description": "更新后的知识点描述",
    "difficulty": "HARD",
    "updatedAt": "2025-06-21T14:30:00"
  }
}
```

**错误响应**
- 400 Bad Request: 参数验证失败
- 403 Forbidden: 无权修改此知识点
- 404 Not Found: 知识点不存在
- 409 Conflict: 知识点名称已存在

---

## 5. 删除知识点
**删除指定知识点**

### 请求信息
| 项目         | 内容                                      |
| ------------ | ----------------------------------------- |
| **HTTP方法** | DELETE                                    |
| **端点**     | `/api/teacher/knowledge-points/{pointId}` |
| **认证**     | Bearer Token                              |

### 路径参数
| 参数    | 类型   | 必需 | 说明     |
| ------- | ------ | ---- | -------- |
| pointId | String | 是   | 知识点ID |

### 响应
**成功响应 (204 No Content)**  
无响应体

**错误响应**
- 403 Forbidden: 无权删除此知识点
- 404 Not Found: 知识点不存在
- 409 Conflict: 知识点包含子节点或关联资源
```json
{
  "code": 409,
  "message": "无法删除知识点",
  "details": {
    "reason": "包含子知识点",
    "childCount": 3
  }
}
```

---

## 6. 管理知识点关联
**添加/移除知识点之间的关联关系**

### 请求信息
| 项目             | 内容                                                |
| ---------------- | --------------------------------------------------- |
| **HTTP方法**     | POST                                                |
| **端点**         | `/api/teacher/knowledge-points/{pointId}/relations` |
| **认证**         | Bearer Token                                        |
| **Content-Type** | `application/json`                                  |

### 路径参数
| 参数    | 类型   | 必需 | 说明     |
| ------- | ------ | ---- | -------- |
| pointId | String | 是   | 知识点ID |

### 请求体
```json
{
  "operation": "ADD", // ADD 或 REMOVE
  "targetPointId": "kp005",
  "relationType": "PREREQUISITE" // PREREQUISITE, RELATED, DEPENDENCY
}
```

### 响应
**成功响应 (200 OK)**
```json
{
  "code": 200,
  "message": "关联关系添加成功",
  "data": {
    "sourcePointId": "kp002",
    "targetPointId": "kp005",
    "relationType": "PREREQUISITE"
  }
}
```

**错误响应**
- 400 Bad Request: 无效操作或参数
- 403 Forbidden: 无权操作知识点
- 404 Not Found: 知识点不存在
- 409 Conflict: 关联关系已存在或无效

---

## 错误码汇总
| 状态码 | 错误码 | 说明                   |
| ------ | ------ | ---------------------- |
| 200    | 200    | 操作成功               |
| 201    | 201    | 知识点创建成功         |
| 204    | 204    | 操作成功，无返回内容   |
| 400    | 400    | 请求参数错误           |
| 403    | 403    | 无操作权限             |
| 404    | 404    | 资源不存在             |
| 409    | 409    | 资源冲突或业务规则冲突 |
| 500    | 500    | 服务器内部错误         |

---

## 请求示例 (cURL)

### 创建知识点
```bash
curl -X POST "https://api.aicourse.com/v1/api/teacher/courses/c001/knowledge-points" \
-H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
-H "Content-Type: application/json" \
-d '{
  "name": "二叉树",
  "parentId": "kp002",
  "description": "二叉树基本概念和遍历方法",
  "difficulty": "MEDIUM"
}'
```

### 获取知识点树
```bash
curl -X GET "https://api.aicourse.com/v1/api/teacher/courses/c001/knowledge-points" \
-H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

### 更新知识点
```bash
curl -X PUT "https://api.aicourse.com/v1/api/teacher/knowledge-points/kp003" \
-H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
-H "Content-Type: application/json" \
-d '{
  "name": "二叉搜索树",
  "description": "二叉搜索树特性与操作",
  "difficulty": "HARD"
}'
```

### 添加知识点关联
```bash
curl -X POST "https://api.aicourse.com/v1/api/teacher/knowledge-points/kp003/relations" \
-H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
-H "Content-Type: application/json" \
-d '{
  "operation": "ADD",
  "targetPointId": "kp007",
  "relationType": "RELATED"
}'
```

### 删除知识点
```bash
curl -X DELETE "https://api.aicourse.com/v1/api/teacher/knowledge-points/kp008" \
-H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

---

## 设计说明

### 业务规则
1. **层级限制**：知识点最多支持5级嵌套
2. **唯一性约束**：同一课程下知识点名称唯一
3. **删除保护**：
   - 有子知识点时禁止删除
   - 有关联资源时禁止删除
4. **关联限制**：
   - 知识点只能关联同一课程下的其他知识点
   - 禁止循环关联
5. **权限控制**：教师只能管理自己课程的知识点

### 性能优化
1. 树形结构查询使用递归CTE优化
2. 高频访问的知识点树使用Redis缓存
3. 批量操作支持
4. 懒加载关联资源信息

### 扩展功能
1. 知识点版本历史
2. 知识点学习进度跟踪
3. 知识点掌握度分析
4. 智能知识点推荐
5. 知识点依赖关系可视化