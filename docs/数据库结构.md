# 数据库表定义

## 用户表

~~~mysql
CREATE TABLE user (
    user_id VARCHAR(36) PRIMARY KEY COMMENT '用户ID',
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    password VARCHAR(100) NOT NULL COMMENT '加密密码',
    email VARCHAR(100) NOT NULL COMMENT '邮箱',
    phone VARCHAR(20) COMMENT '手机号',
    avatar VARCHAR(255) COMMENT '头像URL',
    real_name VARCHAR(50) NOT NULL COMMENT '真实姓名', -- 添加的 realName 属性
    role ENUM('TEACHER', 'STUDENT') NOT NULL COMMENT '用户角色',
    register_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '注册时间',
    last_login_time DATETIME COMMENT '最后登录时间',
    
    UNIQUE INDEX uk_username (username) COMMENT '用户名唯一索引',
    UNIQUE INDEX uk_email (email) COMMENT '邮箱唯一索引'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户基础信息表';
~~~



## 教师表

~~~mysql
CREATE TABLE teacher (
    teacher_id VARCHAR(36) PRIMARY KEY COMMENT '教师ID',
    title VARCHAR(50) COMMENT '职称',
    department VARCHAR(100) COMMENT '所属院系',
    bio TEXT COMMENT '简介',
    
    CONSTRAINT fk_teacher_user 
        FOREIGN KEY (teacher_id) REFERENCES user(user_id)
        ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='教师信息表';
~~~



## 学生表

~~~mysql
CREATE TABLE student (
    student_id VARCHAR(36) PRIMARY KEY COMMENT '学生ID',
    student_number VARCHAR(20) NOT NULL COMMENT '学号',
    grade VARCHAR(20) COMMENT '年级',
    major VARCHAR(50) COMMENT '专业',
    
    UNIQUE INDEX uk_student_number (student_number) COMMENT '学号唯一索引',
    
    CONSTRAINT fk_student_user 
        FOREIGN KEY (student_id) REFERENCES user(user_id)
        ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学生信息表';
~~~



## 课程表

~~~mysql
CREATE TABLE course (
    course_id VARCHAR(36) PRIMARY KEY COMMENT '课程ID',
    course_code VARCHAR(20) NOT NULL COMMENT '课程编号',
    name VARCHAR(100) NOT NULL COMMENT '课程名称',
    description TEXT COMMENT '课程描述',
    credit FLOAT NOT NULL COMMENT '学分',
    hours INT NOT NULL COMMENT '学时',
    semester VARCHAR(50) COMMENT '学期',
    teacher_id VARCHAR(36) NOT NULL COMMENT '授课教师ID',
    knowledge_graph_id VARCHAR(36) COMMENT '知识图谱ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    UNIQUE INDEX uk_course_code (course_code) COMMENT '课程编号唯一索引',
    
    CONSTRAINT fk_course_teacher 
        FOREIGN KEY (teacher_id) REFERENCES teacher(teacher_id)
        ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='课程表';
~~~



## 课程选修表

~~~mysql
CREATE TABLE course_enrollment (
    enrollment_id VARCHAR(36) PRIMARY KEY COMMENT '选课ID',
    student_id VARCHAR(36) NOT NULL COMMENT '学生ID',
    course_id VARCHAR(36) NOT NULL COMMENT '课程ID',
    enrollment_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '选课时间',
    status ENUM('ENROLLED', 'COMPLETED', 'WITHDRAWN') DEFAULT 'ENROLLED' COMMENT '选课状态',
    final_grade FLOAT DEFAULT 0.0 COMMENT '最终成绩',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    UNIQUE INDEX uk_student_course (student_id, course_id) COMMENT '学生-课程唯一索引',
    
    CONSTRAINT fk_enrollment_student 
        FOREIGN KEY (student_id) REFERENCES student(student_id)
        ON DELETE CASCADE ON UPDATE CASCADE,
        
    CONSTRAINT fk_enrollment_course 
        FOREIGN KEY (course_id) REFERENCES course(course_id)
        ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='课程选课表';
~~~



## 任务表

~~~mysql
CREATE TABLE task (
    task_id VARCHAR(36) PRIMARY KEY COMMENT '任务ID',
    course_id VARCHAR(36) NOT NULL COMMENT '所属课程ID',
    title VARCHAR(100) NOT NULL COMMENT '任务标题',
    description TEXT COMMENT '任务描述',
    type ENUM('ASSIGNMENT', 'EXAM', 'VIDEO', 'READING', 'REPORT') NOT NULL COMMENT '任务类型',
    deadline DATETIME NOT NULL COMMENT '截止时间',
    max_score FLOAT DEFAULT 100.0 COMMENT '满分分值',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    
    INDEX idx_course (course_id),
    INDEX idx_deadline (deadline),
    
    CONSTRAINT fk_task_course 
        FOREIGN KEY (course_id) REFERENCES course(course_id)
        ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='课程任务表';
~~~



## 资源表

~~~mysql
create table resource
(
    resource_id varchar(36)                                      not null comment '资源ID'
        primary key,
    course_id   varchar(36)                                      not null comment '所属课程ID',
    name        varchar(100)                                     not null comment '资源名称',
    type        enum ('PPT', 'PDF', 'VIDEO', 'DOCUMENT', 'LINK') not null comment '资源类型',
    url         varchar(255)                                     not null comment '资源路径',
    upload_time datetime default CURRENT_TIMESTAMP               null comment '上传时间',
    uploader_id varchar(36)                                      not null comment '上传者ID',
    size        bigint   default 0                               null comment '文件大小(字节)',
    duration    float                                            null comment '视频时长（秒），仅视频资源有效',
    description text                                             null comment '资源描述',
    view_count  int      default 0                               null comment '查看次数',
    constraint fk_resource_course
        foreign key (course_id) references course (course_id)
            on update cascade on delete cascade,
    constraint fk_resource_uploader
        foreign key (uploader_id) references user (user_id)
            on update cascade on delete cascade
)
    comment '课程资源表';

create index idx_course
    on resource (course_id);

create index idx_type
    on resource (type);
~~~



## 任务资源关联表

~~~mysql
CREATE TABLE task_resource (
    task_id VARCHAR(36) NOT NULL COMMENT '任务ID',
    resource_id VARCHAR(36) NOT NULL COMMENT '资源ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '关联时间',
    
    PRIMARY KEY (task_id, resource_id),
    
    CONSTRAINT fk_tr_task 
        FOREIGN KEY (task_id) REFERENCES task(task_id)
        ON DELETE CASCADE ON UPDATE CASCADE,
        
    CONSTRAINT fk_tr_resource 
        FOREIGN KEY (resource_id) REFERENCES resource(resource_id)
        ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='任务-资源关联表';
~~~



## 提交表

~~~mysql
CREATE TABLE submission (
    submission_id VARCHAR(36) PRIMARY KEY COMMENT '提交ID',
    task_id VARCHAR(36) NOT NULL COMMENT '任务ID',
    student_id VARCHAR(36) NOT NULL COMMENT '学生ID',
    submit_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '提交时间',
    content TEXT COMMENT '文本内容',
    grade FLOAT COMMENT '得分',
    feedback TEXT COMMENT '反馈',
    status ENUM('SUBMITTED', 'GRADED', 'RETURNED') DEFAULT 'SUBMITTED' COMMENT '提交状态',
    
    INDEX idx_task_student (task_id, student_id),
    
    CONSTRAINT fk_submission_task 
        FOREIGN KEY (task_id) REFERENCES task(task_id)
        ON DELETE CASCADE ON UPDATE CASCADE,
        
    CONSTRAINT fk_submission_student 
        FOREIGN KEY (student_id) REFERENCES student(student_id)
        ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='作业提交表';
~~~

